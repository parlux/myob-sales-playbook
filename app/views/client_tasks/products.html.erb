<main>
  <div class="container">
    <div class="row">
    <% @products.each do |product| %>
      <button data-id="<%= product.id %>" data-product="<%= product.name.downcase %>" class="btn-toggle btn-product"><%= product.name %></button>
    <% end %>

    <table class="benefits-table">
      <tbody>
        <tr>
          <th>Client Task</th>
          <th>Feature</th>
          <th>Description</th>
        </tr>
      <% @client_tasks.each do |client_task| %>
        <tr>
          <td><%= client_task[:client_task].name %></td>
          <td><%= client_task[:feature].name %></td>

          <% @products.each do |product| %>
          <% match = false %>
          <td class="desc <%= product.name.downcase %>">
            <% client_task[:benefits].each do |description| %>
            <% if product.name.downcase == description[:product].name.downcase %>
            <% match = true %>
            <textarea data-id="<%= description[:id] %>" data-product-id="<%= description[:product].id %>"  data-feature-id="<%= client_task[:feature].id %>" class="client-benefit" style="width: 100%;"><%= description[:benefits] %></textarea>
            <% end %>
            <% end %>

            <% if !match %>
            <textarea data-product-id="<%= product.id %>" data-feature-id="<%= client_task[:feature].id %>" class="client-benefit" style="width: 100%;"></textarea>
            <% end %>
          </td>
          <% end %>

        </tr>
      <% end %>
      </tbody>
    </table>

    <button id="save-client-benefits">SAVE</button>
  </div>
</main>

<%= render partial: "footer", locals: { prev_page_link: client_tasks_path, next_page_link: products_path } %>

<style>
  .product-toggle.active { border: 1px solid pink; }
  .benefits-table td { border-top: 1px solid #666; padding: 2px 10px; }
</style>
